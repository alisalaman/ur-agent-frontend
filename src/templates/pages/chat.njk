{% extends "layouts/default.njk" %}

{% block pageTitle %}Chat Interface{% endblock %}

{% block content %}
<div class="govuk-width-container">
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <h1 class="govuk-heading-xl">Chat Interface</h1>
      
      <div id="connection-status" class="govuk-chat-status govuk-chat-status--connecting">
        Connecting...
      </div>
      
      <div id="chat-container" class="govuk-chat-container">
        <div id="chat-messages" class="govuk-chat-messages">
          <div class="govuk-chat-message govuk-chat-message--system">
            <p class="govuk-body">Welcome! How can I help you today?</p>
          </div>
        </div>
        
        <div id="chat-input-container" class="govuk-chat-input-container">
          <form id="chat-form" class="govuk-form">
            <div class="govuk-form-group">
              <label class="govuk-label" for="message-input">
                Your message
              </label>
              <textarea 
                class="govuk-textarea" 
                id="message-input" 
                name="message" 
                rows="3"
                placeholder="Type your message here..."
                required
                disabled
              ></textarea>
            </div>
            <button type="submit" class="govuk-button" data-module="govuk-button" disabled>
              Send message
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // Initialize chat when page loads
  document.addEventListener('DOMContentLoaded', function() {
    const sessionId = '{{ sessionId }}';
    const userId = '{{ userId }}';
    const wsConfig = {
      url: '{{ wsUrl }}',
      reconnectAttempts: 5,
      reconnectDelay: 1000,
      heartbeatInterval: 30000,
      timeout: 10000
    };
    
    const chatContainer = document.getElementById('chat-container');
    const chatWindow = new ChatWindow(chatContainer, sessionId, userId, wsConfig);
    
    // Cleanup on page unload
    window.addEventListener('beforeunload', function() {
      chatWindow.disconnect();
    });
  });
</script>
{% endblock %}